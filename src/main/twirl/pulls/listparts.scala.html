@(issues: List[service.IssuesService.IssueInfo],
  page: Int,
  openCount: Int,
  closedCount: Int,
  condition: service.IssuesService.IssueSearchCondition,
  collaborators: List[String] = Nil,
  milestones: List[model.Milestone] = Nil,
  labels: List[model.Label] = Nil,
  repository: Option[service.RepositoryService.RepositoryInfo],
  hasWritePermission: Boolean)(implicit context: app.Context)
@import context._
@import view.helpers._
@import service.IssuesService.IssueInfo
@*
@repository.map { repository =>
  @if(hasWritePermission){
    <div class="pull-right">
      @helper.html.paginator(page, (if(condition.state == "open") openCount else closedCount), service.PullRequestService.PullRequestLimit, 7, condition.toURL)
      <a href="@url(repository)/compare" class="btn btn-small btn-success">New pull request</a>
    </div>
  }
}
*@
@*
<div class="btn-group">
  <a class="btn btn-small@if(condition.state == "open"){ active}" href="@condition.copy(state = "open").toURL">@openCount Open</a>
  <a class="btn btn-small@if(condition.state == "closed"){ active}" href="@condition.copy(state = "closed").toURL">@closedCount Closed</a>
</div>
@helper.html.dropdown(
  value  = (condition.sort, condition.direction) match {
    case ("created" , "desc") => "Newest"
    case ("created" , "asc" ) => "Oldest"
    case ("comments", "desc") => "Most commented"
    case ("comments", "asc" ) => "Least commented"
    case ("updated" , "desc") => "Recently updated"
    case ("updated" , "asc" ) => "Least recently updated"
  },
  prefix = "Sort",
  mini   = false
){
  <li>
    <a href="@condition.copy(sort="created",  direction="desc").toURL">
      @helper.html.checkicon(condition.sort == "created"  && condition.direction == "desc") Newest
    </a>
  </li>
  <li>
    <a href="@condition.copy(sort="created",  direction="asc" ).toURL">
      @helper.html.checkicon(condition.sort == "created"  && condition.direction == "asc") Oldest
    </a>
  </li>
  <li>
    <a href="@condition.copy(sort="comments", direction="desc").toURL">
      @helper.html.checkicon(condition.sort == "comments"  && condition.direction == "desc") Most commented
    </a>
  </li>
  <li>
    <a href="@condition.copy(sort="comments", direction="asc" ).toURL">
      @helper.html.checkicon(condition.sort == "comments"  && condition.direction == "asc") Least commented
    </a>
  </li>
  <li>
    <a href="@condition.copy(sort="updated",  direction="desc").toURL">
      @helper.html.checkicon(condition.sort == "updated"  && condition.direction == "desc") Recently updated
    </a>
  </li>
  <li>
    <a href="@condition.copy(sort="updated",  direction="asc" ).toURL">
      @helper.html.checkicon(condition.sort == "updated"  && condition.direction == "asc") Least recently updated
    </a>
  </li>
}
*@
<table class="table table-bordered table-hover table-issues">
  <tr>
    <th style="background-color: #eee;">
      <input type="checkbox"/>
      <a class="button-link@if(condition.state == "open"  ){ selected}" href="@condition.copy(state = "open"  ).toURL">@openCount Open</a>
      <a class="button-link@if(condition.state == "closed"){ selected}" href="@condition.copy(state = "closed").toURL">@closedCount Closed</a>
      <div class="pull-right">
        @helper.html.dropdown("Author", flat = true) {
        @collaborators.map { collaborator =>
        <li>
          <a href="@condition.copy(author = (if(condition.author == Some(collaborator)) None else Some(collaborator))).toURL">
            @helper.html.checkicon(condition.author == Some(collaborator))
            @avatar(collaborator, 20) @collaborator
          </a>
        </li>
        }
        }
        @helper.html.dropdown("Label", flat = true) {
        @labels.map { label =>
        <li>
          <a href="@condition.copy(labels = (if(condition.labels.contains(label.labelName)) condition.labels - label.labelName else condition.labels + label.labelName)).toURL">
            @helper.html.checkicon(condition.labels.contains(label.labelName))
            <span style="background-color: #@label.color;" class="label-color">&nbsp;&nbsp;</span>
            @label.labelName
          </a>
        </li>
        }
        }
        @helper.html.dropdown("Milestone", flat = true) {
        <li>
          <a href="@condition.copy(milestoneId = Some(None)).toURL">
            @helper.html.checkicon(condition.milestoneId == Some(None)) Issues with no milestone
          </a>
        </li>
        @milestones.filter(_.closedDate.isEmpty).map { milestone =>
        <li>
          <a href="@condition.copy(milestoneId = Some(Some(milestone.milestoneId))).toURL">
            @helper.html.checkicon(condition.milestoneId == Some(Some(milestone.milestoneId))) @milestone.title
          </a>
        </li>
        }
        }
        @helper.html.dropdown("Assignee", flat = true) {
        @collaborators.map { collaborator =>
        <li>
          <a href="@condition.copy(assigned = Some(collaborator)).toURL">
            @helper.html.checkicon(condition.assigned == Some(collaborator))
            @avatar(collaborator, 20) @collaborator
          </a>
        </li>
        }
        }
        @helper.html.dropdown("Sort", flat = true){
        <li>
          <a href="@condition.copy(sort="created",  direction="desc").toURL">
          @helper.html.checkicon(condition.sort == "created"  && condition.direction == "desc") Newest
          </a>
        </li>
        <li>
          <a href="@condition.copy(sort="created",  direction="asc" ).toURL">
          @helper.html.checkicon(condition.sort == "created"  && condition.direction == "asc") Oldest
          </a>
        </li>
        <li>
          <a href="@condition.copy(sort="comments", direction="desc").toURL">
          @helper.html.checkicon(condition.sort == "comments"  && condition.direction == "desc") Most commented
          </a>
        </li>
        <li>
          <a href="@condition.copy(sort="comments", direction="asc" ).toURL">
          @helper.html.checkicon(condition.sort == "comments"  && condition.direction == "asc") Least commented
          </a>
        </li>
        <li>
          <a href="@condition.copy(sort="updated",  direction="desc").toURL">
          @helper.html.checkicon(condition.sort == "updated"  && condition.direction == "desc") Recently updated
          </a>
        </li>
        <li>
          <a href="@condition.copy(sort="updated",  direction="asc" ).toURL">
          @helper.html.checkicon(condition.sort == "updated"  && condition.direction == "asc") Least recently updated
          </a>
        </li>
        }
      </div>
    </th>
  </tr>
  @if(issues.isEmpty){
    <tr>
      <td style="padding: 20px; background-color: #eee; text-align: center;">
        No pull requests to show.
      </td>
    </tr>
  }
  @issues.map { case IssueInfo(issue, labels, milestone, commentCount) =>
    <tr>
      <td style="padding-top: 15px; padding-bottom: 15px;">
        @if(hasWritePermission){
          <label class="checkbox" style="cursor: default;">
          <input type="checkbox" value="@issue.issueId"/>
        }
        <img src="@assets/common/images/pullreq-@(if(issue.closed) "closed" else "open").png" style="margin-right: 20px;"/>
        <a href="@path/@issue.userName/@issue.repositoryName/pull/@issue.issueId" class="issue-title">@issue.title</a>
        @labels.map { label =>
          <span class="label-color small" style="background-color: #@label.color; color: #@label.fontColor; padding-left: 4px; padding-right: 4px">@label.labelName</span>
        }
        <span class="pull-right muted">
          @issue.assignedUserName.map { userName =>
            @avatar(userName, 20, tooltip = true)
          }
          <a href="@path/@issue.userName/@issue.repositoryName/issues/@issue.issueId" class="issue-comment-count"><i class="icon-comment"></i>@commentCount</a>
        </span>
        <div class="small muted" style="margin-left: 40px; margin-top: 5px;">
          #@issue.issueId opened by @user(issue.openedUserName, styleClass="username") @datetime(issue.registeredDate)
          <span style="margin: 20px;"><a href="@condition.copy(milestoneId = Some(Some(1))).toURL" class="username">@milestone</a></span>
        </div>
        @if(hasWritePermission){
          </label>
        }
      </td>
    </tr>
  }
</table>
<div class="pull-right">
  @helper.html.paginator(page, (if(condition.state == "open") openCount else closedCount), service.PullRequestService.PullRequestLimit, 10, condition.toURL)
</div>